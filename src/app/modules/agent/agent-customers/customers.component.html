<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Agent Customers" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <div class="d-flex align-items-center flex-wrap gap-2">
                    <div class="flex-shrink-0">

                        <div class="hstack text-nowrap gap-2" ngbDropdown>
                            <!-- Affiliate link -->

                            <button class="btn btn-info add-btn" data-bs-toggle="modal" data-bs-target="#showModal"
                                (click)="createCustomer()"><i class="ri-add-fill me-1 align-bottom"></i>
                                {{'CREATEUSER'|translate}}</button>
                            <button class="btn btn-soft-danger me-1" id="remove-actions" style="display: none"
                                (click)="deleteMultiple(deleteModel)"><i class="ri-delete-bin-2-line"></i></button>
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#addmembers"
                                (click)="openEnd(filtetcontent)"><i class="ri-filter-2-line me-1 align-bottom"></i>
                                {{"FILTERS"|translate}}</button>
                            <button class="btn btn-soft-success"
                                (click)="csvFileExport()">{{"EXPORT"|translate}}</button>
                            <button type="button" id="dropdownMenuLink1" data-bs-toggle="dropdown" aria-expanded="false"
                                style="display: none" class="btn btn-soft-info arrow-none" ngbDropdownToggle><i
                                    class="ri-more-2-fill"></i></button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink1" ngbDropdownMenu>
                                <li><a class="dropdown-item" href="javascript:void(0);">All</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0);">Last Week</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0);">Last Month</a></li>
                                <li><a class="dropdown-item" href="javascript:void(0);">Last Year</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <div>
                            Your affiliate link: <a href="{{affiliateLink}}" target="_blank">{{affiliateLink}}</a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--end col-->
    <div class="col-xxl-9">
        <div class="card" id="contactList">
            <div class="card-header">
                <div class="row g-3">
                    <div class="hstack text-nowrap gap-1">
                        <button *ngIf="fieldSelected " class="btn btn-warning me-1" data-bs-toggle="modal"
                            data-bs-target="#addmembers" (click)="send('email')"><i
                                class="ri-mail-line me-1 align-bottom"></i> {{"SENDEMAIL"|translate}}</button>
                        <button *ngIf="fieldSelected " class="btn btn-info me-1" data-bs-toggle="modal"
                            data-bs-target="#addmembers" (click)="send('sms')"><i
                                class="ri-question-answer-line me-1 align-bottom"></i> {{"SENDSMS"|translate}}</button>
                        <button *ngIf="fieldSelected " class="btn btn-danger me-1" data-bs-toggle="modal"
                            data-bs-target="#addmembers" (click)="deleteSelected()"><i
                                class="ri-delete-bin-6-line me-1 align-bottom"></i> {{"DELETE"|translate}}</button>
                    </div>
                    <div class="col-md-4">
                        <div class="search-box">
                            <input type="text" name="searchTerm" class="form-control" placeholder="{{'SFC'|translate}}"
                                [(ngModel)]="contentService.searchTerm">
                            <i class="ri-search-line search-icon"></i>
                        </div>
                    </div>
                    <div class="col-md-auto ms-auto">
                        <!-- <div class="d-flex align-items-center gap-2">
                            <span class="text-muted text-nowrap">Sort by: </span>
                            <select class="form-control mb-0" data-choices data-choices-search-false
                                id="choices-single-default" (click)="SortFilter();">
                                <option value="Dname">Name</option>
                                <option value="Dcompany">Company</option>
                                <option value="Dscore">Lead</option>
                            </select>
                        </div> -->
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div>
                    <div class="table-responsive table-card">
                        <table class="table align-middle table-nowrap table-hover">
                            <thead class="table-light text-muted">
                                <tr>
                                    <th scope="col" style="width: 50px;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkAll"
                                                [value]="masterSelected"
                                                (change)="masterSelected = !masterSelected;masterChanged()">
                                        </div>
                                    </th>
                                    <th *ngIf="colsToView.name"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="name" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"NAME"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.email"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="email" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"EMAIL"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.phone"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="phone" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"PHONE"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.country"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"COUNTRY"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.city"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="city" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"PROFILE.CITY.TEXT"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.zipcode"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"ZIPCODE"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.streetAddress"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"STADDRESS"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.type"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"TYPE"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.status"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"STATUS"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.roles"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"ROLES"|translate}}
                                        </p>
                                    </th>
                                    <th *ngIf="colsToView.createdAt"
                                        class="sort cursor-pointer {{sortCol == 'user.email'? sortClass:''}}"
                                        data-sort="country" scope="col">
                                        <p class="pe-3 mb-0">
                                            {{"CREATEDAT"|translate}}
                                        </p>
                                    </th>
                                    <th scope="col">{{"ACTION"|translate}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="cursor-pointer" *ngFor="let data of CustomersData$ | async"
                                    id="c_{{data.id}}"
                                    (click)="viewDataGet(data.id,data.firstName,data.lastName,data.type);checkForSelected()">
                                    <th scope="row">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="checkAll"
                                                id="check-{{data.id}}" value="{{data.id}}" (change)="checkForSelected()"
                                                [(ngModel)]="data.isSelected">
                                        </div>
                                    </th>
                                    <td class="name" *ngIf="colsToView.name">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0"><img [src]="data.avatar | safeUrl" alt=""
                                                    class="avatar-xs rounded-circle"></div>
                                            <div class="flex-grow-1 ms-2 name">
                                                <ngb-highlight [result]="data.firstName"
                                                    [term]="contentService.searchTerm">
                                                </ngb-highlight> {{" "}}<ngb-highlight [result]="data.lastName"
                                                    [term]="contentService.searchTerm">
                                                </ngb-highlight>
                                            </div>
                                        </div>
                                    </td>

                                    <td *ngIf="colsToView.email">
                                        <ngb-highlight [result]="data.email" [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.phone">
                                        <ngb-highlight [result]="data.phone" [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.country">
                                        <ngb-highlight [result]="data.address?.country"
                                            [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.city">
                                        <ngb-highlight [result]="data.address?.city" [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.zipcode">
                                        <ngb-highlight [result]="data.address?.zipCode"
                                            [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.streetAddress">
                                        <ngb-highlight [result]="data.address?.streetAdress"
                                            [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.type">
                                        <ngb-highlight [result]="data.type.toString()"
                                            [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.status">
                                        <ngb-highlight [result]="data.status" [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td *ngIf="colsToView.roles">
                                        <div class="d-flex flex-wrap gap-1">
                                            <span class="badge badge-soft-primary fs-11" *ngFor="let r of data.roles">
                                                <!-- <i class="ri-checkbox-circle-line align-bottom"></i> -->
                                                <ngb-highlight [result]="r.name" [term]="contentService.searchTerm">
                                                </ngb-highlight></span>
                                        </div>

                                    </td>
                                    <td *ngIf="colsToView.createdAt">
                                        <ngb-highlight [result]="data.createdAt" [term]="contentService.searchTerm">
                                        </ngb-highlight>
                                    </td>
                                    <td>
                                        <div class="flex-shrink-0">
                                            <div class="dropdown" container="body" ngbDropdown>
                                                <a href="javascript:void(0);" class="arrow-none" role="button"
                                                    id="dropdownMenuLink2" data-bs-toggle="dropdown"
                                                    aria-expanded="false" ngbDropdownToggle>
                                                    <i class="ri-more-2-fill fs-14"></i>
                                                </a>


                                                <ul class="dropdown-menu dropdown-menu-end"
                                                    aria-labelledby="dropdownMenuLink2" ngbDropdownMenu>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                            (mousedown)="callUser(data)">{{"CALLUSER"|translate}}</a>
                                                    </li>
                                                    <li><a class="dropdown-item" href="javascript:void(0);"
                                                            (mousedown)="editUser(data)">{{"EDITUSER"|translate}}</a>
                                                    </li>
                                                    <li><a class="dropdown-item text-danger" href="javascript:void(0);"
                                                            (mousedown)="deleteUser(data.id)">{{"DELETE"|translate}}</a>
                                                    </li>
                                                    <li><a *ngIf="allowLoginAs" class="dropdown-item"
                                                            href="javascript:void(0);"
                                                            (mousedown)="loginAs(data.id)">{{"LOGINAS"|translate}}
                                                            {{data.firstName}}</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="row justify-content-md-between align-items-md-center mt-3">
                        <div class="col col-sm-6">
                            <div class="dataTables_info mb-2" id="tickets-table_info" role="status" aria-live="polite">
                                {{"SHOWING"|translate}}
                                {{contentService.startIndex}} {{'TO'|translate}}
                                {{contentService.endIndex}} {{"OF"|translate}} {{contentService.totalRecords}}
                                {{"ENTERIES"|translate}}
                            </div>
                        </div>
                        <!-- Pagination -->
                        <div class="col col-sm-6">
                            <div class="text-sm-right float-end listjs-pagination">
                                <ngb-pagination [collectionSize]="(total | async)!" [(page)]="contentService.page"
                                    [maxSize]="5" [rotate]="true" [ellipses]="false" [boundaryLinks]="true"
                                    [pageSize]="contentService.pageSize">
                                </ngb-pagination>
                            </div>
                        </div>
                        <!-- End Pagination -->
                        <div id="elmLoader" [ngClass]="{'d-none':!(loading$ |async)}">
                            <div class="spinner-border text-primary avatar-sm" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contacts Create Model -->


            </div>
        </div>
        <!--end card-->
    </div>
    <!--end col-->
    <div class="col-xxl-3" id="contact-view-detail">

        <customer-card [customer]="ecustomer"></customer-card>
        <!--end col-->
    </div>

</div>
<!--end row-->

<!-- removeItemModal -->
<ng-template #deleteModel let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="deleteRecord-close"
                (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mt-2 text-center">
                <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                    colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px"></lord-icon>
                <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                    <h4>You are about to delete a contact ?</h4>
                    <p class="text-muted mx-4 mb-0">Deleting your contact will remove all of your information from our
                        database.</p>
                </div>
            </div>
            <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                <button class="btn btn-link link-success fw-medium text-decoration-none" data-bs-dismiss="modal"
                    (click)="modal.close('Close click')" id="deleteRecord-close"><i
                        class="ri-close-line me-1 align-middle"></i> Close</button>
                <button type="button" class="btn w-sm btn-danger " id="delete-product" (click)="deleteData(deleteId)"
                    (click)="modal.close('Close click')">Yes, Delete It!</button>
            </div>
        </div>
    </div><!-- /.modal-content -->
</ng-template>
<account-list [user]="selectedUser" [userId]="userId" [userType]="userType"
    [colsFilter]="accountsFilter"></account-list>

<ng-template #filtetcontent let-offcanvas>
    <div class="offcanvas-header bg-light">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">{{"USERSFILTER"|translate}}</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"
            (click)="offcanvas.dismiss('Cross click')"></button>
    </div>
    <!--end offcanvas-header-->

    <form action="" class="d-flex flex-column justify-content-end h-100">
        <div class="offcanvas-body">
            <div>
                <label for="leads-tags"
                    class="form-label text-muted text-uppercase fw-semibold mb-3">{{"COLS"|translate}}</label>
                <div class="row g-3">
                    <div class="col-lg-6" *ngFor="let col of cusCols">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="{{col.name+'sss'}}" value="{{col.name}}"
                                [checked]="col.visible" name="{{col.name+'sss'}}" (change)="col.visible = !col.visible">
                            <label class="form-check-label" for="{{col.name+'sss'}}">{{(col.name|uppercase) |
                                translate}}</label>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!--end offcanvas-body-->
    </form>

    <div class="offcanvas-header bg-light">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">{{"ACCFILTER"|translate}}</h5>

    </div>
    <!--end offcanvas-header-->

    <form action="" class="d-flex flex-column justify-content-end h-100">
        <div class="offcanvas-body">
            <div>
                <label for="leads-tags"
                    class="form-label text-muted text-uppercase fw-semibold mb-3">{{"COLS"|translate}}</label>
                <div class="row g-3">
                    <div class="col-lg-6" *ngFor="let col of accCols">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="{{col.name+'sss'}}" value="{{col.name}}"
                                [checked]="col.visible" name="{{col.name+'sss'}}" (change)="col.visible = !col.visible">
                            <label class="form-check-label" for="{{col.name+'sss'}}">{{(col.name|uppercase) |
                                translate}}</label>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!--end offcanvas-body-->
        <div class="offcanvas-footer border-top p-3 text-center hstack gap-2">
            <button class="btn btn-light w-100">{{"CLEARFILTER"|translate}}</button>
            <button type="submit" class="btn btn-primary w-100" (click)="setCols()">{{"FILTER"|translate}}</button>
        </div>
        <!--end offcanvas-footer-->
    </form>
</ng-template>